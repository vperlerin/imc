"use strict";(self.webpackChunkimc2025=self.webpackChunkimc2025||[]).push([[8442],{7806:(e,t,a)=>{a.d(t,{A:()=>l});var s=a(6540),n=a(1083);const l=(e,t)=>{const[a,l]=(0,s.useState)(null),[i,r]=(0,s.useState)(!1);return{deleteParticipant:async(a,s)=>{if(!a)return null;r(!0),l(null);try{const i=await n.A.post("https://imc2025.imo.net/php/admin/api/delete_participant.php",{id:a.id,delete_type:s});return i.data.success?(e((e=>e.filter((e=>e.id!==a.id)))),t((e=>e.filter((e=>e.id!==a.id))))):l(i.data.message||"Failed to delete participant."),i}catch(e){const t=e.response?.data?.message||"An unexpected error occurred.";return l(t),{data:{success:!1,message:t}}}finally{r(!1)}},errorDelete:a,isDeleting:i}}},8082:(e,t,a)=>{a.r(t),a.d(t,{default:()=>j});const s={};var n=a(8027),l=a(408),i=a(7647),r=a(6942),d=a.n(r),c=a(6645),o=a(6540),m=a(3318),h=a(1083);var p=a(7806),u=a(5846),x=a(4848);const j=()=>{const[e,t]=(0,o.useState)([]),[a,r]=(0,o.useState)(""),[j,b]=(0,o.useState)("last_name"),[f,N]=(0,o.useState)(null),[g,y]=(0,o.useState)(!1),[v,w]=(0,o.useState)(!1),[_,C]=(0,o.useState)(""),[S,k]=(0,o.useState)(""),{participants:A,loading:F,error:P,setParticipants:D}=(()=>{const[e,t]=(0,o.useState)([]),[a,s]=(0,o.useState)(!0),[n,l]=(0,o.useState)(null);return(0,o.useEffect)((()=>{(async()=>{try{const e=await(0,m.L)((()=>h.A.get("https://imc2025.imo.net/php/admin/api/onsite_participants.php")));if(!e.data.success||!Array.isArray(e.data.data))throw new Error(e.data.message||"Unexpected API response format.");t(e.data.data)}catch(e){l(e.message||"Failed to fetch participants. Please refresh the page.")}finally{s(!1)}})()}),[]),{participants:e,loading:a,error:n,setParticipants:t}})(),{deleteParticipant:E,errorDelete:L,isDeleting:I}=(0,p.A)(D,t);(0,o.useEffect)((()=>{if(a){const e=a.toLowerCase();t(A.filter((t=>(t[j]?String(t[j]).toLowerCase():"").includes(e))))}else t(A)}),[a,j,A]);const T=A.length,$=A.filter((e=>!0===e.confirmation_sent)).length;return(0,x.jsxs)(i.A,{breadcrumb:[{url:"/admin/participants/onsite",name:"On-site Participants"}],isMaxWidth:!0,title:"ON-SITE Participants",rightContent:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("strong",{children:"Confirmed:"})," ",$," / ",T]}),children:[S&&(0,x.jsx)("div",{className:"alert alert-danger fw-bolder",children:S}),_&&(0,x.jsx)("div",{className:"alert alert-success fw-bolder",children:_}),P&&(0,x.jsx)("p",{className:"alert alert-danger fw-bolder",children:P}),F||I?(0,x.jsx)(c.A,{}):(0,x.jsxs)(x.Fragment,{children:[L&&(0,x.jsx)("p",{className:"alert alert-danger",children:L}),(0,x.jsxs)("div",{className:"d-flex gap-2 mb-3",children:[(0,x.jsxs)("select",{className:"form-select w-auto",value:j,onChange:e=>b(e.target.value),children:[(0,x.jsx)("option",{value:"last_name",children:"Search by Last Name"}),(0,x.jsx)("option",{value:"email",children:"Search by Email"})]}),(0,x.jsxs)("div",{className:"position-relative w-auto",children:[(0,x.jsx)("input",{type:"text",className:"form-control pe-5",placeholder:`Enter ${j.replace("_"," ")}`,value:a,onChange:e=>r(e.target.value)}),(0,x.jsx)(l.Xj1,{className:"position-absolute top-50 end-0 translate-middle-y me-2"})]})]}),(0,x.jsx)("div",{className:"table-responsive",style:{maxWidth:"calc(100vw - 2rem)"},children:(0,x.jsxs)("table",{className:"table table-striped",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{children:"Reg. Date"}),(0,x.jsx)("th",{children:"Name"}),(0,x.jsx)("th",{children:"Total"}),(0,x.jsx)("th",{children:"Paid"}),(0,x.jsx)("th",{children:"Due"}),(0,x.jsx)("th",{children:"Method"}),(0,x.jsx)("th",{children:"Confirmed"}),(0,x.jsx)("th",{children:"Conf. Email"}),(0,x.jsx)("th",{})]})}),(0,x.jsx)("tbody",{children:e.length>0?e.map((e=>(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{children:e.created_at.split(" ")[0]}),(0,x.jsxs)("td",{children:[e.title," ",e.first_name," ",e.last_name]}),(0,x.jsx)("td",{children:"paypal"===e.payment_method.toLowerCase()?(0,x.jsxs)(x.Fragment,{children:[parseFloat(e.total_due)+parseFloat(e.paypal_fee),"€"]}):(0,x.jsxs)(x.Fragment,{children:[e.total_due,"€"]})}),(0,x.jsxs)("td",{children:[e.total_paid,"€"]}),(0,x.jsx)("td",{className:d()({"text-success":(()=>{const t=Number(e.total_due),a=Number(e.total_paid),s=Number(e.paypal_fee||0);return 0===("paypal"===e.payment_method?.toLowerCase()?t+s-a:t-a)})()}),children:"paypal"===e.payment_method?.toLowerCase()?(0,x.jsxs)(x.Fragment,{children:[(Number(e.total_due)+Number(e.paypal_fee)-Number(e.total_paid)).toFixed(2),"€"]}):(0,x.jsxs)(x.Fragment,{children:[(Number(e.total_due)-Number(e.total_paid)).toFixed(2),"€"]})}),(0,x.jsx)("td",{children:e.payment_method||"n/a"}),(0,x.jsx)("td",{children:"1"===e.confirmation_sent?(0,x.jsx)(x.Fragment,{children:"✅"}):"❌"}),(0,x.jsx)("td",{className:d()(e?.confirmation_date&&"text-success"),children:e.confirmation_date?(0,u.Lu)(e.confirmation_date):"❌"}),(0,x.jsx)("td",{children:(0,x.jsxs)("div",{className:"d-flex gap-2 justify-content-end",children:[(0,x.jsx)("a",{href:`/admin/participants/onsite/payment/${e.id}`,className:d()(s.action,"btn btn-sm btn-outline-success fw-bolder"),children:"Payments"}),(0,x.jsx)("a",{href:`/admin/participants/onsite/${e.id}`,className:d()(s.action,"btn btn-sm btn-outline-primary fw-bolder"),children:"Edit"}),(0,x.jsx)("button",{className:d()(s.action,"btn btn-sm btn-outline-danger fw-bolder"),onClick:()=>(e=>{N(e),y(!0)})(e),children:(0,x.jsx)(n.H8h,{})})]})})]},e.id))):(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:"9",className:"text-center",children:"No onsite participants found."})})})]})})]}),(g||v)&&(0,x.jsx)("div",{className:"modal-backdrop fade show"}),g&&f&&(0,x.jsx)("div",{className:"modal show d-block",children:(0,x.jsx)("div",{className:"modal-dialog",children:(0,x.jsxs)("div",{className:"modal-content",children:[(0,x.jsxs)("div",{className:"modal-header",children:[(0,x.jsx)("h5",{className:"modal-title",children:"Cancel Registration"}),(0,x.jsx)("button",{type:"button",className:"btn-close",onClick:()=>y(!1)})]}),(0,x.jsxs)("div",{className:"modal-body",children:[!1,"Are you sure you want to permanently delete all data related to this participant?"]}),(0,x.jsxs)("div",{className:"modal-footer",children:[(0,x.jsx)("button",{className:"btn btn-outline-secondary fw-bolder",onClick:()=>y(!1),children:"Cancel"}),!1,(0,x.jsx)("button",{className:"btn btn-outline-danger fw-bolder ms-auto",onClick:()=>{y(!1),w(!0)},children:"Hard Delete"})]})]})})}),v&&(0,x.jsx)("div",{className:"modal show d-block",children:(0,x.jsx)("div",{className:"modal-dialog",children:(0,x.jsxs)("div",{className:"modal-content",children:[(0,x.jsxs)("div",{className:"modal-header",children:[(0,x.jsx)("h5",{className:"modal-title",children:"Confirm Permanent Deletion"}),(0,x.jsx)("button",{type:"button",className:"btn-close",onClick:()=>w(!1)})]}),(0,x.jsx)("div",{className:"modal-body",children:(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Are you absolutely sure?"})," This action cannot be undone."]})}),(0,x.jsxs)("div",{className:"modal-footer",children:[(0,x.jsx)("button",{className:"btn btn-outline-danger  fw-bolder",onClick:()=>{(async e=>{if(f)try{const t=await E(f,e);t?.data?.success?C(t.data.message||"Participant deleted successfully!"):k(t?.data?.message||"Impossible to delete the participant for now, please try again later.")}catch(e){k("An unexpected error occurred while deleting the participant.")}})("hard"),w(!1)},children:"Yes, Delete"}),(0,x.jsx)("button",{className:"btn btn-outline-secondary fw-bolder",onClick:()=>w(!1),children:"No"})]})]})})})]})}}}]);