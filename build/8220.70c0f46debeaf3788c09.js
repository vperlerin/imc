"use strict";(self.webpackChunkimc2025=self.webpackChunkimc2025||[]).push([[8220],{578:(e,t,a)=>{a.d(t,{A:()=>o});const s="index-module__cursor--VNUwr";var n=a(6942),l=a.n(n),i=a(8027),c=a(6540),r=a(5846),d=a(4848);const o=e=>{let{participants:t,withActions:a=!0,customActions:n=null,onDelete:o=null}=e;const[m,h]=(0,c.useState)(null),[p,u]=(0,c.useState)("asc"),x=e=>{m===e?u("asc"===p?"desc":"asc"):(h(e),u("asc"))},j=[...t].sort(((e,t)=>{if(!m)return 0;let a=e[m],s=t[m];return["total_due","total_paid","paypal_fee"].includes(m)&&(a=parseFloat(a)||0,s=parseFloat(s)||0),"created_at"!==m&&"confirmation_date"!==m||(a=new Date(a).getTime()||0,s=new Date(s).getTime()||0),a<s?"asc"===p?-1:1:a>s?"asc"===p?1:-1:0}));return(0,d.jsx)("div",{className:"table-responsive",style:{maxWidth:"calc(100vw - 2rem)"},children:(0,d.jsxs)("table",{className:"table table-striped",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:s,onClick:()=>x("id"),children:"#"}),(0,d.jsx)("th",{className:s,onClick:()=>x("created_at"),children:"Reg. Date"}),(0,d.jsx)("th",{className:s,onClick:()=>x("last_name"),children:"Name"}),(0,d.jsx)("th",{className:s,onClick:()=>x("total_due"),children:"Total"}),(0,d.jsx)("th",{className:s,onClick:()=>x("total_paid"),children:"Paid"}),(0,d.jsx)("th",{className:s,onClick:()=>x("due_amount"),children:"Due"}),(0,d.jsx)("th",{className:s,onClick:()=>x("payment_method"),children:"Method"}),(0,d.jsx)("th",{className:s,onClick:()=>x("confirmation_sent"),children:"Confirmed"}),(0,d.jsx)("th",{className:s,onClick:()=>x("confirmation_date"),children:"Conf. Email"}),(a||n)&&(0,d.jsx)("th",{})]})}),(0,d.jsx)("tbody",{children:j.length>0?j.map((e=>{const t=parseFloat(e.total_due)||0,s=parseFloat(e.total_paid)||0,c=parseFloat(e.paypal_fee||0),m="paypal"===e.payment_method_name?.toLowerCase(),h=m?t+c-s:t-s;return(0,d.jsxs)("tr",{children:[(0,d.jsx)("td",{children:e.id}),(0,d.jsx)("td",{children:e.created_at.split(" ")[0]}),(0,d.jsxs)("td",{children:[e.title," ",e.first_name," ",e.last_name]}),(0,d.jsxs)("td",{children:[m?(t+c).toFixed(2):t.toFixed(2),"€"]}),(0,d.jsxs)("td",{children:[s.toFixed(2),"€"]}),(0,d.jsxs)("td",{className:l()({"text-success":0===h}),children:[h.toFixed(2),"€"]}),(0,d.jsx)("td",{children:e.payment_method_name||"n/a"}),(0,d.jsx)("td",{children:"1"===e.confirmation_sent?"✅":"❌"}),(0,d.jsx)("td",{className:l()(e?.confirmation_date&&"text-success"),children:e.confirmation_date?(0,r.Lu)(e.confirmation_date):"❌"}),a&&o&&(0,d.jsx)("td",{children:(0,d.jsxs)("div",{className:"d-flex gap-2 justify-content-end",children:[(0,d.jsx)("a",{href:`/admin/participants/online/payment/${e.id}`,className:"btn btn-sm btn-outline-success fw-bolder",children:"Payments"}),(0,d.jsx)("a",{href:`/admin/participants/online/${e.id}`,className:"btn btn-sm btn-outline-primary fw-bolder",children:"Edit"}),(0,d.jsx)("button",{className:"btn btn-sm btn-outline-danger fw-bolder",onClick:()=>(e=>{o?.(e)})(e),children:(0,d.jsx)(i.H8h,{})})]})}),n&&(0,d.jsx)(d.Fragment,{children:n})]},e.id)})):(0,d.jsx)("tr",{children:(0,d.jsx)("td",{colSpan:a?10:9,className:"text-center",children:"No participants found."})})})]})})}},928:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var s=a(408),n=a(7647),l=a(6645),i=a(6540),c=a(3318),r=a(1083);var d=a(7806),o=a(578),m=a(4848);const h=()=>{const[e,t]=(0,i.useState)([]),[a,h]=(0,i.useState)(""),[p,u]=(0,i.useState)("last_name"),[x,j]=(0,i.useState)(null),[b,f]=(0,i.useState)(!1),[N,g]=(0,i.useState)(!1),[y,_]=(0,i.useState)(""),[w,v]=(0,i.useState)(""),{participants:C,loading:k,error:A,setParticipants:S}=(()=>{const[e,t]=(0,i.useState)([]),[a,s]=(0,i.useState)(!0),[n,l]=(0,i.useState)(null);return(0,i.useEffect)((()=>{(async()=>{try{const e=await(0,c.L)((()=>r.A.get("https://imc2025.imo.net/php/admin/api/online_participants.php")));if(!e.data.success||!Array.isArray(e.data.data))throw new Error(e.data.message||"Unexpected API response format.");t(e.data.data)}catch(e){l(e.message||"Failed to fetch participants. Please refresh the page.")}finally{s(!1)}})()}),[]),{participants:e,loading:a,error:n,setParticipants:t}})(),{deleteParticipant:D,errorDelete:F,isDeleting:P}=(0,d.A)(S,t);(0,i.useEffect)((()=>{if(a){const e=a.toLowerCase();t(C.filter((t=>(t[p]?String(t[p]).toLowerCase():"").includes(e))))}else t(C)}),[a,p,C]);const E=C.length,L=C.filter((e=>!0===e.confirmation_sent)).length;return console.log("PARTICIPANTS IN ADMIN TABLE ",C),(0,m.jsxs)(n.A,{breadcrumb:[{url:"/admin/participants/onsite",name:"Onsite Participants"}],isMaxWidth:!0,title:"ONLINE Participants",rightContent:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("strong",{children:"Confirmed:"})," ",L," / ",E]}),children:[w&&(0,m.jsx)("div",{className:"alert alert-danger fw-bolder",children:w}),y&&(0,m.jsx)("div",{className:"alert alert-success fw-bolder",children:y}),A&&(0,m.jsx)("p",{className:"alert alert-danger fw-bolder",children:A}),k||P?(0,m.jsx)(l.A,{}):(0,m.jsxs)(m.Fragment,{children:[F&&(0,m.jsx)("p",{className:"alert alert-danger",children:F}),(0,m.jsxs)("div",{className:"d-flex gap-2 mb-3",children:[(0,m.jsxs)("select",{className:"form-select w-auto",value:p,onChange:e=>u(e.target.value),children:[(0,m.jsx)("option",{value:"last_name",children:"Search by Last Name"}),(0,m.jsx)("option",{value:"email",children:"Search by Email"})]}),(0,m.jsxs)("div",{className:"position-relative w-auto",children:[(0,m.jsx)("input",{type:"text",className:"form-control pe-5",placeholder:`Enter ${p.replace("_"," ")}`,value:a,onChange:e=>h(e.target.value)}),(0,m.jsx)(s.Xj1,{className:"position-absolute top-50 end-0 translate-middle-y me-2"})]})]}),(0,m.jsx)(o.A,{participants:e,onDelete:e=>{j(e),f(!0)}})]}),(b||N)&&(0,m.jsx)("div",{className:"modal-backdrop fade show"}),b&&x&&(0,m.jsx)("div",{className:"modal show d-block",children:(0,m.jsx)("div",{className:"modal-dialog",children:(0,m.jsxs)("div",{className:"modal-content",children:[(0,m.jsxs)("div",{className:"modal-header",children:[(0,m.jsx)("h5",{className:"modal-title",children:"Cancel Registration"}),(0,m.jsx)("button",{type:"button",className:"btn-close",onClick:()=>f(!1)})]}),(0,m.jsxs)("div",{className:"modal-body",children:[!1,"Are you sure you want to permanently delete all data related to this participant?"]}),(0,m.jsxs)("div",{className:"modal-footer",children:[(0,m.jsx)("button",{className:"btn btn-outline-secondary fw-bolder",onClick:()=>f(!1),children:"Cancel"}),!1,(0,m.jsx)("button",{className:"btn btn-outline-danger fw-bolder ms-auto",onClick:()=>{f(!1),g(!0)},children:"Hard Delete"})]})]})})}),N&&(0,m.jsx)("div",{className:"modal show d-block",children:(0,m.jsx)("div",{className:"modal-dialog",children:(0,m.jsxs)("div",{className:"modal-content",children:[(0,m.jsxs)("div",{className:"modal-header",children:[(0,m.jsx)("h5",{className:"modal-title",children:"Confirm Permanent Deletion"}),(0,m.jsx)("button",{type:"button",className:"btn-close",onClick:()=>g(!1)})]}),(0,m.jsx)("div",{className:"modal-body",children:(0,m.jsxs)("p",{children:[(0,m.jsx)("strong",{children:"Are you absolutely sure?"})," This action cannot be undone."]})}),(0,m.jsxs)("div",{className:"modal-footer",children:[(0,m.jsx)("button",{className:"btn btn-outline-danger  fw-bolder",onClick:()=>{(async e=>{if(x)try{const t=await D(x,e);t?.data?.success?_(t.data.message||"Participant deleted successfully!"):v(t?.data?.message||"Impossible to delete the participant for now, please try again later.")}catch(e){v("An unexpected error occurred while deleting the participant.")}})("hard"),g(!1)},children:"Yes, Delete"}),(0,m.jsx)("button",{className:"btn btn-outline-secondary fw-bolder",onClick:()=>g(!1),children:"No"})]})]})})})]})}},7806:(e,t,a)=>{a.d(t,{A:()=>l});var s=a(6540),n=a(1083);const l=(e,t)=>{const[a,l]=(0,s.useState)(null),[i,c]=(0,s.useState)(!1);return{deleteParticipant:async(a,s)=>{if(!a)return null;c(!0),l(null);try{const i=await n.A.post("https://imc2025.imo.net/php/admin/api/delete_participant.php",{id:a.id,delete_type:s});return i.data.success?(e((e=>e.filter((e=>e.id!==a.id)))),t((e=>e.filter((e=>e.id!==a.id))))):l(i.data.message||"Failed to delete participant."),i}catch(e){const t=e.response?.data?.message||"An unexpected error occurred.";return l(t),{data:{success:!1,message:t}}}finally{c(!1)}},errorDelete:a,isDeleting:i}}}}]);