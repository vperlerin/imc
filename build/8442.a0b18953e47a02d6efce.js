"use strict";(self.webpackChunkimc2025=self.webpackChunkimc2025||[]).push([[8442],{8082:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});const s={};var n=a(408),l=a(7647),i=a(6942),r=a.n(i),c=a(6645),d=a(6540),o=a(3318),h=a(1083);var m=a(7806),x=a(5846),j=a(4848);const p=()=>{const[e,t]=(0,d.useState)([]),[a,i]=(0,d.useState)(""),[p,u]=(0,d.useState)("last_name"),[b,f]=(0,d.useState)(null),[g,N]=(0,d.useState)(!1),[y,w]=(0,d.useState)(!1),[v,C]=(0,d.useState)(""),[_,k]=(0,d.useState)(""),{participants:S,loading:P,error:A,setParticipants:D}=(()=>{const[e,t]=(0,d.useState)([]),[a,s]=(0,d.useState)(!0),[n,l]=(0,d.useState)(null);return(0,d.useEffect)((()=>{(async()=>{try{const e=await(0,o.L)((()=>h.A.get("https://imc2025.imo.net/php/admin/api/onsite_participants.php")));if(!e.data.success||!Array.isArray(e.data.data))throw new Error(e.data.message||"Unexpected API response format.");t(e.data.data)}catch(e){l(e.message||"Failed to fetch participants. Please refresh the page.")}finally{s(!1)}})()}),[]),{participants:e,loading:a,error:n,setParticipants:t}})(),{deleteParticipant:F,errorDelete:E,isDeleting:L}=(0,m.A)(D,t);(0,d.useEffect)((()=>{if(a){const e=a.toLowerCase();t(S.filter((t=>(t[p]?String(t[p]).toLowerCase():"").includes(e))))}else t(S)}),[a,p,S]);const T=S.length,I=S.filter((e=>!0===e.confirmation_sent)).length,R=async e=>{if(b)try{const t=await F(b,e);t?.data?.success?C(t.data.message||"Participant deleted successfully!"):k(t?.data?.message||"Impossible to delete the participant for now, please try again later.")}catch(e){k("An unexpected error occurred while deleting the participant.")}};return(0,j.jsxs)(l.A,{breadcrumb:[{url:"/admin/participants/onsite",name:"On-site Participants"}],isMaxWidth:!0,title:"ON-SITE Participants",rightContent:(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("strong",{children:"Confirmed:"})," ",I," / ",T]}),children:[_&&(0,j.jsx)("div",{className:"alert alert-danger fw-bolder",children:_}),v&&(0,j.jsx)("div",{className:"alert alert-success fw-bolder",children:v}),A&&(0,j.jsx)("p",{className:"alert alert-danger fw-bolder",children:A}),P||L?(0,j.jsx)(c.A,{}):(0,j.jsxs)(j.Fragment,{children:[E&&(0,j.jsx)("p",{className:"alert alert-danger",children:E}),(0,j.jsxs)("div",{className:"d-flex gap-2 mb-3",children:[(0,j.jsxs)("select",{className:"form-select w-auto",value:p,onChange:e=>u(e.target.value),children:[(0,j.jsx)("option",{value:"last_name",children:"Search by Last Name"}),(0,j.jsx)("option",{value:"email",children:"Search by Email"})]}),(0,j.jsxs)("div",{className:"position-relative w-auto",children:[(0,j.jsx)("input",{type:"text",className:"form-control pe-5",placeholder:`Enter ${p.replace("_"," ")}`,value:a,onChange:e=>i(e.target.value)}),(0,j.jsx)(n.Xj1,{className:"position-absolute top-50 end-0 translate-middle-y me-2"})]})]}),(0,j.jsx)("div",{className:"table-responsive",style:{maxWidth:"calc(100vw - 2rem)"},children:(0,j.jsxs)("table",{className:"table table-striped",children:[(0,j.jsx)("thead",{children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{children:"Reg. Date"}),(0,j.jsx)("th",{children:"Name"}),(0,j.jsx)("th",{children:"Total Due"}),(0,j.jsx)("th",{children:"Total Paid"}),(0,j.jsx)("th",{children:"Pay. Method"}),(0,j.jsx)("th",{children:"Confirmed"}),(0,j.jsx)("th",{})]})}),(0,j.jsx)("tbody",{children:e.length>0?e.map((e=>(0,j.jsxs)("tr",{children:[(0,j.jsx)("td",{children:e.created_at.split(" ")[0]}),(0,j.jsxs)("td",{children:[e.title," ",e.first_name," ",e.last_name]}),(0,j.jsx)("td",{children:"paypal"===e.payment_method.toLowerCase()?(0,j.jsxs)(j.Fragment,{children:[parseFloat(e.total_due)+parseFloat(e.paypal_fee),"€"]}):(0,j.jsxs)(j.Fragment,{children:[e.total_due,"€"]})}),(0,j.jsxs)("td",{children:[e.total_paid,"€"]}),(0,j.jsx)("td",{children:e.payment_method||"n/a"}),(0,j.jsx)("td",{children:"1"===e.confirmation_sent?(0,j.jsxs)(j.Fragment,{children:["✅ ",e.confirmation_date&&(0,x.Lu)(e.confirmation_date)]}):"❌"}),(0,j.jsx)("td",{children:(0,j.jsxs)("div",{className:"d-flex gap-2 justify-content-end",children:[(0,j.jsx)("a",{href:`/admin/participants/onsite/payment/${e.id}`,className:r()(s.action,"btn btn-sm btn-outline-success fw-bolder"),children:"Payments"}),(0,j.jsx)("a",{href:`/admin/participants/onsite/${e.id}`,className:r()(s.action,"btn btn-sm btn-outline-primary fw-bolder"),children:"Edit"}),(0,j.jsx)("button",{className:r()(s.action,"btn btn-sm btn-outline-danger fw-bolder"),onClick:()=>(e=>{f(e),N(!0)})(e),children:"Cancel Registration"})]})})]},e.id))):(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:"7",className:"text-center",children:"No onsite participants found."})})})]})})]}),(g||y)&&(0,j.jsx)("div",{className:"modal-backdrop fade show"}),g&&b&&(0,j.jsx)("div",{className:"modal show d-block",children:(0,j.jsx)("div",{className:"modal-dialog",children:(0,j.jsxs)("div",{className:"modal-content",children:[(0,j.jsxs)("div",{className:"modal-header",children:[(0,j.jsx)("h5",{className:"modal-title",children:"Cancel Registration"}),(0,j.jsx)("button",{type:"button",className:"btn-close",onClick:()=>N(!1)})]}),(0,j.jsxs)("div",{className:"modal-body",children:[(0,j.jsxs)("p",{children:["Are you sure you want to cancel ",(0,j.jsxs)("b",{children:[b.first_name," ",b.last_name]}),"'s registration?"]}),(0,j.jsx)("p",{children:(0,j.jsx)("strong",{children:"Choose:"})}),(0,j.jsxs)("ul",{children:[(0,j.jsxs)("li",{children:[(0,j.jsx)("strong",{className:"text-warning",children:"Soft Delete:"})," Keeps record but marks as 'cancelled' - so we can keep track of the reimbursement."]}),(0,j.jsxs)("li",{children:[(0,j.jsx)("strong",{className:"text-danger",children:"Hard Delete:"})," Permanently removes data."]})]})]}),(0,j.jsxs)("div",{className:"modal-footer",children:[(0,j.jsx)("button",{className:"btn btn-outline-secondary fw-bolder",onClick:()=>N(!1),children:"Cancel"}),(0,j.jsx)("button",{className:"btn btn-outline-warning fw-bolder",onClick:()=>R("soft"),children:"Soft Delete"}),(0,j.jsx)("button",{className:"btn btn-outline-danger fw-bolder ms-auto",onClick:()=>{N(!1),w(!0)},children:"Hard Delete"})]})]})})}),y&&(0,j.jsx)("div",{className:"modal show d-block",children:(0,j.jsx)("div",{className:"modal-dialog",children:(0,j.jsxs)("div",{className:"modal-content",children:[(0,j.jsxs)("div",{className:"modal-header",children:[(0,j.jsx)("h5",{className:"modal-title",children:"Confirm Permanent Deletion"}),(0,j.jsx)("button",{type:"button",className:"btn-close",onClick:()=>w(!1)})]}),(0,j.jsx)("div",{className:"modal-body",children:(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Are you absolutely sure?"})," This action cannot be undone."]})}),(0,j.jsxs)("div",{className:"modal-footer",children:[(0,j.jsx)("button",{className:"btn btn-outline-secondary fw-bolder",onClick:()=>w(!1),children:"No"}),(0,j.jsx)("button",{className:"btn btn-outline-danger  fw-bolder",onClick:()=>{R("hard"),w(!1)},children:"Yes, Delete"})]})]})})})]})}}}]);